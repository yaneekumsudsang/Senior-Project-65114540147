<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/html5-qrcode/minified/html5-qrcode.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center">

    <!-- กล่องแสดง QR Code Reader -->
    <div class="bg-white rounded-xl shadow-lg p-4 w-full max-w-sm text-center">
        <h2 class="text-xl font-semibold text-gray-700 mb-4">สแกน QR Code</h2>
        <div id="reader" class="h-64 w-full rounded-lg border-dashed border-2 border-gray-300">
        <!-- กล้อง -->
        <div id="reader" class="h-64 w-full rounded-lg border-dashed border-2 border-gray-300"></div>
        </div>
        <p id="error-message" class="text-red-500 text-sm mt-4 hidden">ไม่สามารถเปิดกล้องได้ โปรดตรวจสอบสิทธิ์การใช้งานกล้อง</p>

    <!-- แสดงผลลัพธ์ -->
    <div class="mt-6 bg-white rounded-lg shadow-md w-full max-w-lg p-6 text-center">
        <p id="scan-result" class="text-lg text-gray-600 bg-gray-100 p-2 rounded-md"> กำลังรอการสแกน QR Code... </p>
    </div>
    </div>
    <!-- ปุ่มปิด -->
    <button onclick="closeScanner()" class="mt-6 bg-white text-[#164863] w-12 h-12 rounded-full flex items-center justify-center shadow-md hover:bg-[#164863] hover:text-white transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
    </button>

    <!-- JavaScript -->
    <script>

        function closeScanner() {
            // นำกลับไปยังหน้าแรกหรือหน้าที่ต้องการ
            window.location.href = "/";
        }

        function onScanSuccess(decodedText, decodedResult) {
            console.log(`QR Code Scanned: ${decodedText}`);
            // แสดงผล QR Code ที่สแกนได้
            document.getElementById('scan-result').textContent = `QR Code: ${decodedText}`;

            // เปลี่ยนหน้าไปยัง URL ที่สแกนได้ (ถ้าเป็น URL)
            if (decodedText.startsWith("http")) {
                window.location.href = decodedText;
            }
        }

        function onScanError(errorMessage) {
            console.warn(`QR Code Scan Error: ${errorMessage}`);
        }

        // เริ่มต้น html5-qrcode
        const html5QrCode = new Html5Qrcode("reader");

        html5QrCode.start(
            { facingMode: "environment" }, // ใช้กล้องหลัง
            {
                fps: 10, // จำนวนเฟรมต่อวินาที
                qrbox: { width: 250, height: 250 } // ขนาดของกล่องสแกน
            },
            onScanSuccess,
            onScanError
        ).catch(err => {
            console.error(`Error starting QR Code Scanner: ${err}`);
            // แสดงข้อความแจ้งเตือนหากเปิดกล้องไม่ได้
            const errorMessageElement = document.getElementById("error-message");
            errorMessageElement.classList.remove("hidden");
            errorMessageElement.textContent = "ไม่สามารถเปิดกล้องได้: " + err;
        });
    </script>
</body>
</html>