{% extends "nav.html" %}

{% block content %}
    <h1>สแกน QR Code</h1>
    
    <!-- ส่วนแสดงกล้อง -->
    <div id="qr-reader" style="width: 100%; height: 300px;"></div>
    
    <!-- แสดงผล QR Code ที่สแกนได้ -->
    <div id="result" style="margin-top: 20px; font-size: 18px; font-weight: bold;"></div>
    
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <script>
        // ฟังก์ชันสำหรับสแกน QR Code
        function onScanSuccess(decodedText, decodedResult) {
            // เมื่อสแกนสำเร็จจะแสดงผลใน div#result
            document.getElementById('result').textContent = `QR Code Data: ${decodedText}`;
            // หยุดการสแกนหลังจากสแกนครั้งแรก (สามารถลบออกหากต้องการสแกนต่อเนื่อง)
            html5QrCode.stop().then((ignore) => {
                // Code ที่จะทำหลังจากหยุดการสแกน
            }).catch((err) => {
                console.error("ไม่สามารถหยุดการสแกนได้:", err);
            });
        }

        function onScanFailure(error) {
            // ฟังก์ชันที่จะทำเมื่อเกิดข้อผิดพลาดในการสแกน
            console.warn(`การสแกน QR Code ล้มเหลว: ${error}`);
        }

        // เริ่มการสแกน QR Code เมื่อโหลดหน้า
        window.onload = function () {
            const html5QrCode = new Html5Qrcode("qr-reader");

            // เริ่มต้นการสแกน QR Code
            html5QrCode.start(
                { facingMode: "environment" }, // ใช้กล้องหลัง
                {
                    fps: 10,  // จำนวนเฟรมต่อวินาที
                    qrbox: 250,  // ขนาดของกล่องสแกน
                },
                onScanSuccess,
                onScanFailure
            ).catch((err) => {
                console.error("ไม่สามารถเริ่มต้นการสแกนได้:", err);
            });
        };
    </script>
{% endblock %}
