<!-- coupon_stats.html -->
{% extends 'nav.html' %}

{% block content %}
{% if is_owner %}
    <h2>สถิติการใช้คูปอง</h2>
    {% for stat in stats %}
    <div class="p-4 border rounded mb-4">
        <h3>{{ stat.promotion.name }}</h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div>
                <p class="font-bold">คูปองทั้งหมด</p>
                <p>{{ stat.total_coupons }}</p>
            </div>
            <div>
                <p class="font-bold">ใช้แล้ว</p>
                <p>{{ stat.used_coupons }}</p>
            </div>
            <div>
                <p class="font-bold">เหลือ</p>
                <p>{{ stat.remaining }}</p>
            </div>
            <div>
                <p class="font-bold">อัตราการใช้</p>
                <p>{{ stat.usage_percentage|floatformat:1 }}%</p>
            </div>
        </div>
    </div>
    {% endfor %}
{% else %}
    <h2>ประวัติการใช้คูปองของคุณ</h2>
    <div class="p-4 border rounded mb-4">
        <p class="font-bold">คูปองที่ใช้ทั้งหมด: {{ stats.total_used }}</p>

        <h3 class="mt-4">การใช้งานล่าสุด</h3>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead>
                    <tr>
                        <th>โปรโมชั่น</th>
                        <th>ร้านค้า</th>
                        <th>วันที่ใช้</th>
                    </tr>
                </thead>
                <tbody>
                    {% for usage in stats.recent_usage %}
                    <tr>
                        <td>{{ usage.coupon.promotion.name }}</td>
                        <td>{{ usage.store.store_name }}</td>
                        <td>{{ usage.used_at|date:"d/m/Y H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endif %}
{% endblock %}